\begin{frame}
    \frametitle{Decision Procedure}
    \begin{itemize}
        \item Given $\Qf=\exists X,\random{} Y.\pf(X,Y)$, $\spb{\Qf}$ equals
              \begin{itemize}
                  \item The maximum conditional satisfying probability $\spb{\pcf{\Qf}{\as^*}}$
                  \item $(\pcf{\pf}{\as_2}\models\pcf{\pf}{\as_1})\limply\spb{\pcf{\Qf}{\as_2}}\leq\spb{\pcf{\Qf}{\as_1}}$
              \end{itemize}
              \pause
        \item Clause-containment learning
              \begin{itemize}
                  \item Prune assignments that select a superset of the selected clauses
                        \begin{itemize}
                            \item An assignments $\as_1$ selects a set of clauses $\pcf{\pf}{\as_1}$
                            \item Avoid such $\as_2$: $\pcf{\pf}{\as_1}\subseteq\pcf{\pf}{\as_2}\limply(\pcf{\pf}{\as_2}\models\pcf{\pf}{\as_1})$
                            \item Learnt clause: $\bigvee\limits_{C\in\pcf{\pf}{\as_1}}\lnot\sv{C}$
                        \end{itemize}
              \end{itemize}
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Decision Procedure}
    \begin{block}{Example: E-MAJSAT Solving}
        Consider $\Qf=\exists e_1,\exists e_2,\exists e_3,\random{0.5} r_1,\random{0.5} r_2,\random{0.5} r_3.\pf$ with
        \begin{itemize}
            \item[] $C_1: (e_1 \lor r_1 \lor r_2)$ $C_2: (e_1 \lor e_2 \lor r_1 \lor r_2 \lor \lnot r_3)$
            \item[] $C_3: (\lnot e_2 \lor \lnot e_3 \lor r_2 \lor \lnot r_3)$ $C_4: (\lnot e_1 \lor e_3 \lor r_3)$
        \end{itemize}
        \begin{table}[t]
            \centering
            \small
            \begin{tabular}{c|c|c|c}
                Assignment                            & Selected Clauses & $\spb{\pcf{\Qf}{\as}}$ & Learnt Clause                \\
                \hline
                $\as_1=\lnot e_1 \lnot e_2 \lnot e_3$ & $\{C_1,C_2\}$    & $0.75$                 & $(\lnot s_1 \lor \lnot s_2)$ \\
                $\as_2=\lnot e_1 e_2 \lnot e_3$       & $\{C_1\}$        & $0.75$                 & $(\lnot s_1)$                \\
                $\as_3=e_1 e_2 \lnot e_3$             & $\{C_4\}$        & $0.5$                  & $(\lnot s_4)$                \\
                $\as_4=e_1 e_2 e_3$                   & $\{C_3\}$        & $0.75$                 & $(\lnot s_3)$                \\
                $\as_5=e_1 \lnot e_2 e_3$             & $\{\}$           & $1$                    & $()$
            \end{tabular}
        \end{table}
        \begin{itemize}
            \item $\spb{\Qf}=1$ with $\as^*=\as_5$
        \end{itemize}
    \end{block}
\end{frame}

\begin{frame}
    \frametitle{Heuristics to Strengthen Learnt Clauses}
    \begin{itemize}
        \item A shorter learnt clause prunes more search space
              \begin{itemize}
                  \item Minimal clause selection: SAT solving
                  \item Induced clause subsumption: syntax checking
                  \item Partial assignment pruning: model counting
              \end{itemize}
              \pause
        \item Extra reasoning effort vs. Effectiveness of strengthened learnt clauses
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Minimal Clause Selection}
    \begin{itemize}
        \item Iteratively solve $\select(X,S)$ to select a minimal set of clauses
              \pause
        \item Recall $\Qf=\exists e_1,\exists e_2,\exists e_3,\random{0.5} r_1,\random{0.5} r_2,\random{0.5} r_3.\pf$ with
              \begin{itemize}
                  \item[] $C_1: (e_1 \lor r_1 \lor r_2)$ $C_2: (e_1 \lor e_2 \lor r_1 \lor r_2 \lor \lnot r_3)$
                  \item[] $C_3: (\lnot e_2 \lor \lnot e_3 \lor r_2 \lor \lnot r_3)$ $C_4: (\lnot e_1 \lor e_3 \lor r_3)$
              \end{itemize}
              \pause
        \item $\as_1=\lnot e_1 \lnot e_2 \lnot e_3$ selects $\{C_1,C_2\}$
              \pause
        \item Solve $\select\land(\lnot s_1\lor\lnot s_2)$ under assumptions $s_3\land s_4$
              \begin{itemize}
                  \item $\as_2=\lnot e_1 e_2 \lnot e_3$, which only selects $\{C_1\}$
                  \item Replace an expensive model-counting call with a SAT call
              \end{itemize}
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Induced Clause Subsumption}
    \begin{itemize}
        \item $C_1$ subsumes $C_2$ if $C_1 \subseteq C_2$ (treat $C_1$ and $C_2$ as sets of literals)
              \pause
        \item Subsumed clauses can be removed from a CNF formula
              \pause
        \item Recall $\Qf=\exists e_1,\exists e_2,\exists e_3,\random{0.5} r_1,\random{0.5} r_2,\random{0.5} r_3.\pf$ with
              \begin{itemize}
                  \item[] $C_1: (e_1 \lor r_1 \lor r_2)$ $C_2: (e_1 \lor e_2 \lor r_1 \lor r_2 \lor \lnot r_3)$
                  \item[] $C_3: (\lnot e_2 \lor \lnot e_3 \lor r_2 \lor \lnot r_3)$ $C_4: (\lnot e_1 \lor e_3 \lor r_3)$
              \end{itemize}
              \pause
        \item $\as_1=\lnot e_1 \lnot e_2 \lnot e_3$ selects $\{C_1,C_2\}$
              \pause
        \item $C_1^Y$ subsumes $C_2^Y$: remove $C_2$ from the set of selected clauses
              \begin{itemize}
                  \item Strengthen the learnt clause to $(\lnot s_1)$
              \end{itemize}
              \pause
        \item Subsumption among $\cy$ clauses is \textit{induced} by clause selection
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Partial Assignment Pruning}
    \begin{itemize}
        \item $C_L=\bigvee\limits_{C\in\pcf{\pf}{\as}}\lnot\sv{C}=\bigvee\limits_{C\in\pcf{\pf}{\as}}\cx$
              \pause
        \item Discard literals from $C_L$ by model counting
              \pause
        \item Recall $\Qf=\exists e_1,\exists e_2,\exists e_3,\random{0.5} r_1,\random{0.5} r_2,\random{0.5} r_3.\pf$ with
              \begin{itemize}
                  \item[] $C_1: (e_1 \lor r_1 \lor r_2)$ $C_2: (e_1 \lor e_2 \lor r_1 \lor r_2 \lor \lnot r_3)$
                  \item[] $C_3: (\lnot e_2 \lor \lnot e_3 \lor r_2 \lor \lnot r_3)$ $C_4: (\lnot e_1 \lor e_3 \lor r_3)$
              \end{itemize}
              \pause
        \item $\as_1=\lnot e_1 \lnot e_2 \lnot e_3$: $C_L=(\lnot s_1\lor\lnot s_2)=(e_1\lor e_2),\spb{\pcf{\Qf}{\as_1}}=0.75$
              \begin{itemize}
                  \item Can we discard $e_2$ from $C_L$?
                  \item $(e_1)$ blocks $\as$ that selects $C_1$: $\spb{\pcf{\Qf}{\as}}\leq\spb{C_1}=0.75\leq\spb{\pcf{\Qf}{\as_1}}$
              \end{itemize}
              \pause
        \item Count weight of selected clauses and compare to current maximum
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Decision Procedure}
    {\scriptsize
        \begin{algorithmic}[1]
            \REQUIRE $\Qf=\exists X,\random{} Y.\pf(X,Y)$
            \ENSURE $\spb{\Qf}$
            \STATE $\select(X,S) := \bigwedge\limits_{C\in\pf}(\sv{C}\equiv\lnot\cx)\land\bigwedge\limits_{\text{pure }l: \vl{l}\in X}l$\label{code:erssat-init-select}
            \STATE $prob := 0$
            \STATE $\texttt{s-table} := \texttt{BuildSubsumptionTable}(\pf)$\label{code:erssat-subsume-table}
            \WHILE{($\sat{\select}$)}
            \STATE $\as := \model{\select}$ (discarding the selection variables)
            \IF{($\sat{\pcf{\pf}{\as}}$)}
            \STATE $\as' := \texttt{SelectMinimalClauses}(\pf,\select)$\label{code:erssat-minimal-clauses}
            \STATE $\varphi := \texttt{RemoveSubsumedClauses}(\pcf{\pf}{\as'},\texttt{s-table})$\label{code:erssat-subsume-clauses}
            \STATE $prob := \max\{prob,\texttt{ComputeWeight}(\random{} Y.\varphi)\}$\label{code:erssat-wmc}
            \STATE $C_S := \bigvee\limits_{C\in\varphi}\lnot\sv{C}$
            \STATE $C_L := \texttt{DiscardLiterals}(\pf,C_S,prob)$\label{code:erssat-discard-literals}
            \ELSE
            \STATE $C_L := \texttt{MinimalConflicting}(\pf,\as)$
            \ENDIF
            \STATE $\select := \select \land C_L$
            \ENDWHILE
            \RETURN $prob$
        \end{algorithmic}
    }
\end{frame}