#!/usr/bin/python3

import numpy as np
import pandas as pd

tool_list = ["ABC", "DC-SSAT", "Cachet", "ApproxMC"]
# Read CSV file generated by table-generator
df = pd.read_csv("./csv/PEC.table.csv", sep="\t")
df = df.fillna(value=np.nan)
# Drop useless rows
df = df.drop([0, 1])
# Adjust circuit names
df = df.replace(regex=r"-0.125.0.01.pec$", value="")
df = df.replace(regex=r"mem_ctrl", value="memctrl")
# Erase CPU time if the task is not done
for tool in tool_list:
    df[tool + " .1"][df[tool + " "] != "done"] = np.nan
# Compute probabilities of ApproxMC
df["ApproxMC-prob"] = df["ApproxMC .3"].apply(
    lambda x: eval(x) if type(x) == str else x
).astype(float) / np.power(2, df["ApproxMC .2"].astype(float))
# Drop useless columns
for tool in tool_list:
    df = df.drop([tool + " "], axis=1)
df = df.drop(["ApproxMC .2", "ApproxMC .3"], axis=1)
df.columns = [
    "Circuit",
    "ABC-T",
    "ABC-P",
    "DC-T",
    "DC-P",
    "Cachet-T",
    "Cachet-P",
    "AMC-T",
    "AMC-P",
]
df.to_csv("./csv/parsed-PEC.table.csv", sep="\t", na_rep="nan", index=False)
